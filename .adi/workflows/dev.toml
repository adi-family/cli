# ADI Local Development Workflow
# Interactive wrapper for dev.sh

[workflow]
name = "dev"
description = "Manage local development services"

[[inputs]]
name = "action"
type = "select"
prompt = "What do you want to do?"
options = [
    "up - Start services",
    "down - Stop services",
    "restart - Restart services",
    "status - Show service status",
    "logs - View service logs",
    "ports - Show assigned ports",
    "clean - Stop and clean up",
    "shell - Open service directory"
]
default = "up - Start services"

[[inputs]]
name = "services"
type = "multi-select"
prompt = "Select services (leave empty for defaults)"
options = [
    "postgres",
    "timescaledb",
    "signaling",
    "auth",
    "platform",
    "web",
    "flowmap",
    "analytics-ingestion",
    "analytics",
    "llm-proxy",
    "cocoon",
    "registry",
    "cocoon-manager"
]
if = "{{ action | starts_with('up') or action | starts_with('restart') }}"

[[inputs]]
name = "log_service"
type = "select"
prompt = "Which service logs to view?"
options = [
    "all",
    "postgres",
    "timescaledb",
    "signaling",
    "auth",
    "platform",
    "web",
    "flowmap",
    "analytics-ingestion",
    "analytics",
    "llm-proxy",
    "cocoon",
    "registry",
    "cocoon-manager"
]
default = "all"
if = "{{ action | starts_with('logs') }}"

[[inputs]]
name = "shell_service"
type = "select"
prompt = "Which service directory?"
options = [
    "postgres",
    "timescaledb",
    "signaling",
    "auth",
    "platform",
    "web",
    "flowmap",
    "analytics-ingestion",
    "analytics",
    "llm-proxy",
    "cocoon",
    "registry",
    "cocoon-manager"
]
if = "{{ action | starts_with('shell') }}"

# Extract action command
[[steps]]
name = "Run dev command"
run = """
# All prelude functions (info, spinner_start, etc.) and variables 
# ($PROJECT_ROOT, $PLATFORM, etc.) are automatically available!

ACTION="{{ action | split(' ') | first }}"
SERVICES="{{ services | join(' ') }}"

info "Running: $ACTION"

case "$ACTION" in
    up|restart)
        if [ -n "$SERVICES" ]; then
            "$WORKFLOWS_DIR/dev.sh" "$ACTION" $SERVICES
        else
            "$WORKFLOWS_DIR/dev.sh" "$ACTION"
        fi
        ;;
    down|status|ports|clean)
        "$WORKFLOWS_DIR/dev.sh" "$ACTION"
        ;;
    logs)
        LOG_SVC="{{ log_service }}"
        if [ "$LOG_SVC" = "all" ]; then
            "$WORKFLOWS_DIR/dev.sh" logs
        else
            "$WORKFLOWS_DIR/dev.sh" logs "$LOG_SVC"
        fi
        ;;
    shell)
        "$WORKFLOWS_DIR/dev.sh" shell "{{ shell_service }}"
        ;;
esac
"""
