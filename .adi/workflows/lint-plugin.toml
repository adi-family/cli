# ADI Plugin Linter Workflow
# Validates plugin structure before publishing

[workflow]
name = "lint-plugin"
description = "Lint and validate a plugin before release"

[[inputs]]
name = "plugin"
type = "select"
prompt = "Select plugin to lint"
# Dynamically discovers all plugins from Cargo.toml [package.metadata.plugin] sections
options_cmd = """
grep -rl 'package.metadata.plugin' crates/*/Cargo.toml crates/*/*/Cargo.toml crates/*/*/*/Cargo.toml 2>/dev/null | while read f; do
    sed -n 's/^id = "\(.*\)"/\1/p' "$f" | head -1
done | sort -u
"""
autocomplete = true
autocomplete_count = 10

[[inputs]]
name = "mode"
type = "select"
prompt = "Lint mode"
options = [
    "check - Report issues only",
    "fix - Attempt to fix common issues",
    "strict - Treat warnings as errors"
]
default = "check - Report issues only"

[[steps]]
name = "Lint plugin"
run = """
PLUGIN="{{ plugin }}"
MODE="{{ mode | split(' ') | first }}"

info "Linting plugin: $PLUGIN (mode: $MODE)"

case "$MODE" in
    check)
        "$WORKFLOWS_DIR/lint-plugin.sh" "$PLUGIN"
        ;;
    fix)
        "$WORKFLOWS_DIR/lint-plugin.sh" --fix "$PLUGIN"
        ;;
    strict)
        "$WORKFLOWS_DIR/lint-plugin.sh" --strict "$PLUGIN"
        ;;
esac
"""
